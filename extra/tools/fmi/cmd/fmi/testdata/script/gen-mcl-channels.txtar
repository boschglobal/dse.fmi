env FMUXML=$REPO_DIR/extra/tools/fmi/test/testdata/fmimcl/fmimcl.xml

# Create the simulation folder (Simer layout)
env
mkdir sim/lib
exec touch sim/lib/libfmimcl.so
mkdir sim/fmu/fmi2fmu
mkdir sim/fmu/fmi2fmu/binaries/linux64
mkdir sim/fmu/fmi2fmu/resources
cp $FMUXML sim/fmu/fmi2fmu/modelDescription.xml
exec touch sim/fmu/fmi2fmu/binaries/linux64/libfmi2fmu.so
exec ls -R $WORK/sim

# Generate the FMI MCL configuration
env
cd sim
exec fmi gen-mcl -fmu fmu/fmi2fmu -outdir model/fmi2fmu -mcl lib/libfmimcl.so -channels '[{"name": "E2MM2E", "alias": "E2MM2E_Alias", "selector":{"selector":"E2M2E_Selector"}}]'
cd ..
exec ls -R $WORK/sim
exists sim/model/fmi2fmu/model.yaml

# Check the generated files
exec cat sim/model/fmi2fmu/model.yaml

yamlcontains sim/model/fmi2fmu/model.yaml $.spec.channels[0].name E2MM2E
yamlcontains sim/model/fmi2fmu/model.yaml $.spec.channels[0].alias E2MM2E_Alias
yamlcontains sim/model/fmi2fmu/model.yaml $.spec.channels[0].selectors.selector E2M2E_Selector
